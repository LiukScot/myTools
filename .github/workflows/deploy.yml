name: Deploy site (hub + myHealth + myMoney)

on:
  workflow_dispatch:
  push:
    branches: [main]
    paths:
      - 'hub/**'
      - 'myHealth/**'
      - 'myMoney/**'
      - 'deploy.sh'
      - '.github/workflows/deploy.yml'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install lftp
        run: sudo apt-get update && sudo apt-get install -y lftp

      - name: Deploy to Hetzner via FTP
        env:
          FTP_HOST: ${{ secrets.FTP_HOST }}
          FTP_USER: ${{ secrets.FTP_USER }}
          FTP_PASS: ${{ secrets.FTP_PASS }}
          BASE_REMOTE: ${{ secrets.BASE_REMOTE }}
          REMOTE_HUB: ${{ secrets.REMOTE_HUB }}
          REMOTE_HEALTH: ${{ secrets.REMOTE_HEALTH }}
          REMOTE_MONEY: ${{ secrets.REMOTE_MONEY }}
        run: |
          set -euo pipefail
          : "${FTP_HOST:?FTP_HOST secret missing}"
          : "${FTP_USER:?FTP_USER secret missing}"
          : "${FTP_PASS:?FTP_PASS secret missing}"
          chmod +x deploy.sh
          ./deploy.sh
