<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>myHealth CSV Importer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <link rel="stylesheet" href="/myhealth/style.css">
</head>

<body>
  <div class="shell">
    <header>
      <div class="title">
        <span class="heart">‚ù§</span>
        <span>myHealth</span>
      </div>
    </header>

    <div class="card auth-card">
      <div class="auth-row">
        <input type="email" id="auth-email" placeholder="Email" autocomplete="username" />
        <input type="password" id="auth-pass" placeholder="Password" autocomplete="current-password" />
        <button class="btn-primary" id="auth-login" type="button">Log in</button>
      </div>
      <div class="status" id="auth-status"></div>
      <pre class="debug-log hidden" id="auth-debug"></pre>
    </div>

    <div id="app-main" class="hidden">
      <div class="top-nav">
        <nav>
          <button class="nav-btn active" data-target="dashboard">
            <svg class="icon" width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M4 13h6V4H4v9zm10 7h6V4h-6v16z" />
            </svg>
            Dashboard
          </button>
          <button class="nav-btn" data-target="newlog">
            <svg class="icon" width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M6 5h12v14H6z" />
              <path d="M9 3v4m6-4v4M8 10h8m-8 4h6" />
            </svg>
            Logs and new entries
          </button>
          <button class="nav-btn" data-target="import">
            <svg class="icon" width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M12 16V4m0 0l-3 3m3-3l3 3" />
              <path d="M6 13v5h12v-5" />
            </svg>
            Import / Export
          </button>
        </nav>
        <div class="top-actions">
          <a class="nav-btn hub-link hidden" id="go-hub" href="/" aria-label="Back to hub">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M15 5l-7 7 7 7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span>Back to hub</span>
          </a>
          <button class="nav-btn danger logout-btn hidden" id="auth-logout" type="button">Log out</button>
        </div>
      </div>

      <section id="dashboard-section">
        <div class="card" id="dashboard-stats">
          <h2>Dashboard</h2>
          <div class="hint">Overview of diary and pain logs.</div>
          <div class="filters">
            <label>From
              <input type="date" id="filter-from" />
            </label>
            <label>To
              <input type="date" id="filter-to" />
            </label>
            <div class="divider"></div>
            <div class="quick-filters">
              <button class="quick-btn" data-range="7">1 week</button>
              <button class="quick-btn" data-range="30">1 month</button>
              <button class="quick-btn" data-range="90">3 months</button>
              <button class="quick-btn" data-range="180">6 months</button>
              <button class="quick-btn" data-range="365">1 year</button>
              <button class="quick-btn" data-range="1095">3 years</button>
              <button class="quick-btn" data-range="all">Since start</button>
            </div>
          </div>
          <div class="dash-grid" id="dash-cards"></div>
        </div>
        <div class="graph-grid" id="dash-graphs"></div>
      </section>

      <section id="newlog-section" class="hidden">
        <div class="card">
          <h2>New Entry</h2>
          <div class="hint">Capture a quick log without waiting for a CSV import.</div>
          <div class="entry-tabs" role="tablist" aria-label="New entry categories">
            <button class="nav-btn entry-btn active" data-entry="pain" type="button">Physical pain</button>
            <button class="nav-btn entry-btn" id="autotherapy-tab" data-entry="autotherapy" type="button">Autotherapy
              ‚óÄ</button>
          </div>

          <div class="entry-panel" data-entry-panel="pain">
            <form id="pain-form">
              <div class="form-grid">
                <div class="form-group">
                  <label for="pain-date">Entry Date/Time</label>
                  <input id="pain-date" name="pain-date" type="datetime-local" />
                  <small>Stored as separate date + time columns; defaults to now if left empty.</small>
                </div>
                <div class="form-group">
                  <label for="pain-level">Pain Level (1-9)</label>
                  <input id="pain-level" name="pain-level" type="number" min="1" max="9" step="1"
                    placeholder="e.g. 6" />
                </div>
                <div class="form-group">
                  <label for="fatigue-level">Fatigue Level (1-9)</label>
                  <input id="fatigue-level" name="fatigue-level" type="number" min="1" max="9" step="1"
                    placeholder="e.g. 4" />
                </div>
                <div class="form-group">
                  <label>Area <button type="button" class="chip-edit" data-edit="area">Edit</button></label>
                  <div id="area-options" class="chip-row" data-field="area"></div>
                  <div id="area-editor" class="chip-editor hidden" data-field="area"></div>
                </div>
                <div class="form-group">
                  <label>Symptoms <button type="button" class="chip-edit" data-edit="symptoms">Edit</button></label>
                  <div id="symptoms-options" class="chip-row" data-field="symptoms"></div>
                  <div id="symptoms-editor" class="chip-editor hidden" data-field="symptoms"></div>
                </div>
                <div class="form-group">
                  <label>Activities <button type="button" class="chip-edit" data-edit="activities">Edit</button></label>
                  <div id="activities-options" class="chip-row" data-field="activities"></div>
                  <div id="activities-editor" class="chip-editor hidden" data-field="activities"></div>
                </div>
                <div class="form-group">
                  <label>Medicines <button type="button" class="chip-edit" data-edit="medicines">Edit</button></label>
                  <div id="medicines-options" class="chip-row" data-field="medicines" data-preselect="all"></div>
                  <div id="medicines-editor" class="chip-editor hidden" data-field="medicines"></div>
                </div>
                <div class="form-group">
                  <label for="pain-note">Notes</label>
                  <textarea id="pain-note" name="pain-note" placeholder="Anything else worth tracking?"></textarea>
                </div>
                <div class="form-group">
                  <label>Habits <button type="button" class="chip-edit" data-edit="habits">Edit</button></label>
                  <div id="habits-options" class="chip-row" data-field="habits"></div>
                  <div id="habits-editor" class="chip-editor hidden" data-field="habits"></div>
                </div>
                <div class="form-group">
                  <label for="coffee-count">Coffee (cups)</label>
                  <input id="coffee-count" name="coffee-count" type="number" min="0" max="9" step="1"
                    placeholder="e.g. 1" />
                </div>
                <div class="form-group">
                  <label>Other <button type="button" class="chip-edit" data-edit="other">Edit</button></label>
                  <div id="other-options" class="chip-row" data-field="other"></div>
                  <div id="other-editor" class="chip-editor hidden" data-field="other"></div>
                </div>
              </div>
              <div class="form-actions">
                <button class="btn-primary btn-plain" id="pain-submit-btn" type="submit">Save new entry</button>
                <button class="btn-muted hidden" id="pain-cancel-btn" type="button">Cancel edit</button>
                <div id="pain-form-status" class="status"></div>
              </div>
            </form>
            <div class="form-divider"></div>
            <div class="card">
              <div class="log-header">
                <h2>Pain log <span id="pain-count" style="color:var(--muted); font-size:14px; margin-left:8px;"></span>
                </h2>
              </div>
              <div class="list-wrap" id="pain-table"></div>
            </div>
          </div>

          <div class="entry-panel hidden" data-entry-panel="autotherapy">
            <div id="autotherapy-stack">
              <div class="entry-tabs autotherapy-subnav" role="tablist" aria-label="Autotherapy entries">
                <button class="nav-btn entry-btn secondary" data-autotherapy="journal" type="button">Journal</button>
                <button class="nav-btn entry-btn secondary" data-autotherapy="cbt" type="button">CBT thought
                  response</button>
                <button class="nav-btn entry-btn secondary" data-autotherapy="dbt" type="button">DBT distress
                  tolerance</button>
              </div>
              <div class="entry-panel hidden" data-autotherapy-panel="journal">
                <form id="journal-form">
                  <div class="form-grid">
                    <div class="form-group">
                      <label for="journal-date">Entry date/time</label>
                      <input id="journal-date" name="journal-date" type="datetime-local" />
                      <small>Stored as separate date + time columns; defaults to now if left empty.</small>
                    </div>
                    <div class="form-group">
                      <label for="journal-mood">Mood level (1-9)</label>
                      <input id="journal-mood" name="journal-mood" type="number" min="1" max="9" step="1"
                        placeholder="e.g. 6" />
                    </div>
                    <div class="form-group">
                      <label for="journal-depression">Depression (1-9)</label>
                      <input id="journal-depression" name="journal-depression" type="number" min="1" max="9" step="1"
                        placeholder="e.g. 4" />
                    </div>
                    <div class="form-group">
                      <label for="journal-anxiety">Anxiety (1-9)</label>
                      <input id="journal-anxiety" name="journal-anxiety" type="number" min="1" max="9" step="1"
                        placeholder="e.g. 5" />
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                      <label for="journal-description">description</label>
                      <textarea id="journal-description" name="journal-description"
                        placeholder="cosa hai fatto oggi?"></textarea>
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                      <label for="journal-gratitude">gratitude</label>
                      <textarea id="journal-gratitude" name="journal-gratitude"
                        placeholder="per cosa sei grato?"></textarea>
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                      <label for="journal-reflection">reflection</label>
                      <textarea id="journal-reflection" name="journal-reflection"
                        placeholder="vuoi riflettere su qualcosa?"></textarea>
                    </div>
                  </div>
                  <div class="form-actions">
                    <button class="btn-primary btn-plain" id="journal-submit-btn" type="submit">Save journal
                      entry</button>
                    <button class="btn-muted hidden" id="journal-cancel-btn" type="button">Cancel edit</button>
                    <div id="journal-form-status" class="status"></div>
                  </div>
                </form>
                <div class="form-divider"></div>
                <div class="card">
                  <div class="log-header">
                    <h2>Journal log <span id="diary-count"
                        style="color:var(--muted); font-size:14px; margin-left:8px;"></span></h2>
                  </div>
                  <div class="list-wrap" id="diary-table"></div>
                </div>
              </div>
              <div class="entry-panel hidden" data-autotherapy-panel="cbt">
                <div class="hint">CBT thought response coming soon.</div>
              </div>
              <div class="entry-panel hidden" data-autotherapy-panel="dbt">
                <div class="hint">DBT distress tolerance coming soon.</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="import-section" class="hidden">
        <div class="card">
          <h2>Import / backup</h2>
          <div class="hint">easily import or export your data</div>

          <div class="stacked-fields" style="gap: 15px;">
            <div class="field-group">
              <label><strong>Import from JSON</strong></label><br>
              <input type="file" id="import-backup-input" accept=".json" />
            </div>
            <div class="field-group">
              <button class="btn-primary btn-plain" id="export-backup-button">Export JSON</button>
            </div>

            <div class="section-divider"></div>

            <div class="field-group">
              <label><strong>Import from XLSX</strong> (sheets: <code>diary</code>, <code>pain</code>)</label><br>
              <input type="file" id="import-xlsx-input" accept=".xlsx,.xls" />
            </div>
            <div class="field-group">
              <button class="btn-primary btn-plain" id="export-xlsx-button">Export XLSX</button>
            </div>

            <div class="section-divider"></div>

            <div class="field-group">
              <button class="nav-btn danger" id="full-purge-button">üß® delete all data</button>
            </div>
          </div>
        </div>

        <div class="status" id="backup-status"></div>
        <pre class="error-box hidden" id="backup-error"></pre>

        <!-- hidden status nodes to satisfy existing refs -->
        <div class="status hidden" id="diary-status-import"></div>
        <div class="status hidden" id="pain-status-import"></div>
    </div>
    </section>
  </div>
  </div>

    <script type="module" src="/myhealth/js/app.js"></script>

</body>

</html>